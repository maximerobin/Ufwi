#!/bin/sh
# $Id$
# File generated by EdenWall: {{ _generation_time_ }}
#
# SCRIPT NAME: resource.d/omshell
# Description: Put the server into the PARTNER-DOWN state using the omshell
#              command.
#
# ha_status : {{ ha_status  }}
#
unset LANG; export LANG
LC_ALL=C
export LC_ALL

usage() {
    echo "usage: $0 DHCPD_IP (start|stop)"
    exit 1
}

omcomd() {
/usr/bin/omshell << COMMANDS
server $1
port 519
connect
new failover-state
set local-state = 1
open
update
COMMANDS
}

if [ $# != 2 ]; then
    usage
else
    case "$2" in
        start)
            {% if ha_status == "SECONDARY" -%}
            # Put the server into the PARTNER-DOWN (1) state
            omcomd {{ SECONDARY_IP }}
            {%- endif %}
            ;;
        stop)
            # failure
            # inform other server than we are down
{% if ha_status == "PRIMARY" -%}
            omcomd {{ SECONDARY_IP }}
{% elif ha_status == "SECONDARY" -%}
            omcomd {{ PRIMARY_IP }}
{%- endif %}
            ;;
    esac
fi

exit
